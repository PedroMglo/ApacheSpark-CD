## 0.1. O que é Spark e PySpark (batch vs streaming)

### O que é o Apache Spark

Apache Spark é um motor distribuído de processamento de dados em memória, desenhado para:

- Processamento **batch** (ETL, agregações, joins, transformações massivas).
- Processamento **quase em tempo real** (**Structured Streaming**).
- Workloads de **SQL**, **machine learning**, **gráficos** e **ETL** dentro de um único runtime.

Principais características:

- **Distribuído**: corre em vários nós (máquinas) em paralelo.
- **Fault-tolerant**: reconstrói resultados em caso de falhas, usando o conceito de *lineage*.
- **Escalável**: de um portátil a centenas/milhares de máquinas.
- **API de alto nível**: DataFrames e SQL; evita-se APIs de baixo nível (RDD) a não ser em casos especiais.

### O que é PySpark

PySpark é a API do Spark para Python.

- O **core** do Spark é em **Scala/Java** (JVM).
- PySpark é um *binding* que permite:
  - Definir transformações (DataFrames, SQL, UDFs) em Python.
  - Enviar estas operações para o plano de execução do Spark (dentro da JVM).
- Em Spark moderno, dás preferência a:
  - `pyspark.sql.SparkSession`
  - DataFrames / SQL
  - Structured Streaming

### Batch vs Streaming (Structured Streaming)

**Batch**:

- Dados “fechados” num intervalo (por exemplo, ficheiros de ontem, tabela estática).
- Cada job processa um conjunto de dados bem definido (ex.: diário, horário).
- Resultado tem início e fim claros.

**Streaming (Structured Streaming)**:

- Modelo **“tabelas em mudança contínua”**.
- Fonte de dados é potencialmente infinita (Kafka, ficheiros que vão chegando, sockets, etc.).
- Spark processa eventos tuplo a tuplo, mas exposto como **DataFrames “infinito”**.
- Ciclo de vida:
  - Define-se uma query `readStream` → transformações → `writeStream`.
  - Spark executa micro-batches ou “continuous processing”.

Conceito chave: **a API é quase a mesma** (DataFrames), o que muda é a **fonte (`read` vs `readStream`)** e o **sink (`write` vs `writeStream`)** e alguns operadores específicos (watermarks, janelas de tempo, etc.).
